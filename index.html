<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CONTRÔLE PASSATION</title>
  <style>
    :root{
      --ink:#111;
      --muted:#666;
      --line:#1a1a1a;
      --bg:#fff;
      --accent:#000;
      --ok-bg:#e8f5e9;      /* vert très clair */
      --ok-accent:#2e7d32;  /* vert foncé */
      --todo-bg:#ffebee;    /* rouge très clair */
      --todo-accent:#c62828;/* rouge foncé */
    }
    html,body{height:100%;}
    body{
      font-family: Arial, Helvetica, sans-serif;
      color:var(--ink);
      background:var(--bg);
      margin:0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Page wrapper sized for A4 with comfortable margins */
    .page{
      max-width: 980px;
      margin: 24px auto;
      padding: 24px;
      background:#fff;
    }

    h1{
      text-align:center;
      letter-spacing: .5px;
      font-size: 24px;
      margin: 0 0 18px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
    }

    .block{
      border: 2px solid var(--line);
      border-radius: 6px;
      padding: 10px 10px 6px;
      page-break-inside: avoid;
    }

    .block h2{
      font-size: 16px;
      margin: 0 0 8px;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    table.check{
      border-collapse: collapse;
      width: 100%;
      font-size: 13px;
    }
    table.check th, table.check td{
      border: 1px solid #ccc;
      padding: 6px 8px;
      vertical-align: top;
    }
    table.check th{
      background:#f2f2f2;
      font-weight: 700;
      text-align:left;
    }
    /* Largeurs + centrage colonnes 2/3 */
    table.check th:nth-child(2),
    table.check th:nth-child(3){
      width:72px; text-align:center;
    }
    table.check td:nth-child(2),
    table.check td:nth-child(3){
      text-align:center;
    }

    /* Couleurs entêtes */
    .head-todo{ background: var(--todo-bg) !important; color: var(--todo-accent); border-color: var(--todo-accent) !important; }
    .head-ok{ background: var(--ok-bg) !important;   color: var(--ok-accent);   border-color: var(--ok-accent) !important; }

    /* Surbrillance des lignes selon le choix */
    .is-todo td{ background: var(--todo-bg); }
    .is-ok   td{ background: var(--ok-bg); }

    .legend{font-size:12px;color:var(--muted);margin:6px 0 0}

    .notes{
      margin-top: 16px;
      border:2px solid var(--line);
      border-radius:6px;
      padding: 10px;
    }
    .notes h3{margin:0 0 6px;font-size:14px;text-transform:uppercase}
    .notes textarea{width:100%;min-height:90px;border:1px solid #ccc;border-radius:4px;padding:8px;font-family:inherit;font-size:13px}

    .flex{display:flex;gap:12px;flex-wrap:wrap}
    .flex .field{flex:1 1 220px}
    .field label{display:block;font-size:12px;color:#333;margin:8px 0 4px}
    .field input, .field textarea, .field select{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;font-size:13px}

    .footer{
      display:grid;gap:12px;grid-template-columns: 1fr 1fr; margin-top: 16px;
    }
    @media (max-width: 700px){.footer{grid-template-columns:1fr}}

    .submitbar{display:flex;gap:12px;align-items:center;justify-content:flex-end;margin-top:18px}
    button[type="submit"]{
      background:#111;color:#fff;border:none;border-radius:6px;padding:10px 16px;font-weight:700;cursor:pointer
    }
    button[type="reset"]{background:#f2f2f2;border:1px solid #ddd;border-radius:6px;padding:10px 14px;cursor:pointer}

    /* Print styles for A4 */
    @media print{
      body{background:#fff}
      .page{margin:0;padding:0;}
      .submitbar{display:none}
      a[href]:after{content:""}
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>CONTRÔLE PASSATION</h1>

    <form id="passationForm">
      <div class="grid" id="sections"></div>

      <div class="notes">
        <h3>Commentaires & informations</h3>
        <div class="flex">
          <div class="field" style="flex:1 1 100%">
            <label for="commentaires">Commentaires et informations diverses (point marchandise / personnel / incident caisse / technique)</label>
            <textarea id="commentaires" name="commentaires" placeholder="Saisir ici..."></textarea>
          </div>
          <div class="field" style="flex:1 1 100%">
            <label for="ruptures">Préciser ici les prochaines ruptures</label>
            <textarea id="ruptures" name="ruptures" placeholder="Produits à risque de rupture, quantités restantes, ETA..."></textarea>
          </div>
        </div>
      </div>

      <div class="footer">
        <div class="block">
          <h2>Équipier caisse matin (si présence le soir)</h2>
          <div class="flex">
            <div class="field"><label for="equipierMatin">Nom</label><input id="equipierMatin" name="equipierMatin" type="text" /></div>
            <div class="field"><label for="ticketsResto">Tickets restaurant</label><input id="ticketsResto" name="ticketsResto" type="text" /></div>
            <div class="field"><label for="chequesVacances">Chèques vacances</label><input id="chequesVacances" name="chequesVacances" type="text" /></div>
            <div class="field"><label for="carteBancaire">Carte bancaire</label><input id="carteBancaire" name="carteBancaire" type="text" /></div>
          </div>
        </div>
        <div class="block">
          <h2>Informations de passation</h2>
          <div class="flex">
            <div class="field"><label for="date">Date</label><input id="date" name="date" type="date" required /></div>
            <div class="field"><label for="heure">Heure</label><input id="heure" name="heure" type="time" required /></div>
            <div class="field" style="flex:1 1 280px"><label for="respUnique">Nom du responsable</label><input id="respUnique" name="responsable" type="text" required /></div>
          </div>
        </div>
      </div>

      <div class="submitbar">
        <button type="reset">Réinitialiser</button>
        <button type="submit">Envoyer la checklist</button>
      </div>
    </form>
  </div>

  <script>
    // --- Modèle des sections et tâches (fidèle au PDF) ---
    const SECTIONS = [
      { title: "Terrasse", tasks: [
        "Sol, tables, chaises",
        "Poubelle",
        "Cendriers vides et disponibles",
        "Sol et surfaces propres"
      ]},
      { title: "Toilettes Clients", tasks: [
        "Papier / savon",
        "Toilettes (cuvette, lunette, rebords)",
        "Odeur",
        "Miroir",
        "Poubelle propre et non pleine",
        "Sèche-mains propre et fonctionnel"
      ]},
      { title: "Cuisine", tasks: [
        "Viandes et suppléments en suffisance",
        "Sauces en suffisance",
        "Frigo rempli",
        "Essuie-mains, savon en suffisance",
        "Poubelles changées",
        "Traçabilité prise",
        "Pertes comptabilisées",
        "Galettes descendues",
        "Rouleaux de papier dans imprimantes",
        "Huile à niveau dans les friteuses",
        "Eau à niveau dans bain-marie",
        "Friteuses filtrées",
        "Filtre friteuse changé",
        "Emballages en suffisance"
      ]},
      { title: "Chambres froides", tasks: [
        "Décongélations préparées",
        "Sauces en double dans meuble froid",
        "CF propres",
        "Caillebotis propres",
        "Étagères propres",
        "Produits remontés / rotation faite",
        "Bacs rouges remplis de frites"
      ]},
      { title: "Salle", tasks: [
        "Sol propre",
        "Tables, pieds de tables, chaises propres",
        "Poubelles propres et non pleines",
        "Musique en marche",
        "Bornes fonctionnelles",
        "Enseigne allumée (si nuit)"
      ]},
      { title: "Comptoir", tasks: [
        "Frigos à boissons remplis",
        "Comptoir desserts rempli",
        "Toppings, nappages, lait en suffisance",
        "Télécommandes, agrafeuse, tampon, téléphone disponibles",
        "DLC contrôlées, signalement si besoin",
        "Meuble O’sucré propre et rangé",
        "Comptoir propre et rangé",
        "Présence pailles/serviettes/gobelets/emballages",
        "Plateaux propres et dressés",
        "Machine à glace propre",
        "Vaisselle propre",
        "Savon, essuie-mains en suffisance",
        "Produits d’entretien en suffisance",
        "Rouleaux pleins dans imprimantes et TPE",
        "Caisse comptée + fond de caisse fait si Glory en panne"
      ]},
      { title: "Réserves", tasks: [
        "Réserve bien rangée",
        "Sol et étagères propres",
        "FIFO / DLC",
        "Disponibilité produits (Caisses, Otter)"
      ]},
      { title: "Étage", tasks: [
        "Sol propre",
        "Toilettes, lavabos, murs propres",
        "Savon, essuie-mains en suffisance",
        "Poubelles non pleines",
        "Miroirs propres"
      ]},
      { title: "Plonge", tasks: [
        "Plonge terminée",
        "Zone et matériel propres",
        "Produits et matériel en suffisance"
      ]},
      { title: "E-Pack Hygiène", tasks: [
        "Nettoyage des postes rempli",
        "Check-list manager remplie"
      ]},
      { title: "Tenue du personnel", tasks: [
        "Complète, propre, repassée",
        "Cheveux attachés",
        "Pas de bijoux sauf alliance",
        "Charlotte, tablier, sur-chaussures en cuisine"
      ]}
    ];

    const sectionsRoot = document.getElementById('sections');

    SECTIONS.forEach((section, sIdx) => {
      const block = document.createElement('section');
      block.className = 'block';

      const h = document.createElement('h2');
      h.textContent = section.title.toUpperCase();

      const table = document.createElement('table');
      table.className = 'check';

      const thead = document.createElement('thead');
      thead.innerHTML = `<tr>
        <th>Tâche</th>
        <th class="head-todo">À FAIRE</th>
        <th class="head-ok">OK</th>
      </tr>`;

      const tbody = document.createElement('tbody');

      section.tasks.forEach((task, tIdx) => {
        const id = `${section.title.replace(/[^a-z0-9]/gi,'_').toLowerCase()}_${tIdx}`;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${task}</td>
          <td><input type="radio" name="${id}" value="A faire" aria-label="${task} à faire" /></td>
          <td><input type="radio" name="${id}" value="OK" aria-label="${task} ok" /></td>
        `;
        // Surbrillance dynamique
        tr.addEventListener('change', (e) => {
          if(e.target.name === id){
            tr.classList.remove('is-todo','is-ok');
            if(e.target.value === 'A faire') tr.classList.add('is-todo');
            if(e.target.value === 'OK')      tr.classList.add('is-ok');
          }
        });
        tbody.appendChild(tr);
      });

      table.appendChild(thead);
      table.appendChild(tbody);
      block.appendChild(h);
      block.appendChild(table);
      sectionsRoot.appendChild(block);
    });

    // Soumission vers Google Apps Script (adapter l'URL)
    document.getElementById('passationForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = new FormData(e.target);
      const payload = {};
      for (const [k,v] of data.entries()) payload[k] = v;

      try{
        const res = await fetch('https://script.google.com/macros/s/VOTRE_SCRIPT_ID/exec',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if(!res.ok) throw new Error('HTTP '+res.status);
        alert('Checklist envoyée avec succès !');
      }catch(err){
        console.error(err);
        alert("Échec de l'envoi. Vérifiez la connexion ou l'URL du script.");
      }
    });
  </script>
</body>
</html>
